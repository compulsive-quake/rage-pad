<div class="app-container" [class.wake-blur]="isWakeDialogOpen" [class.wake-dimmed]="isUiDimmed">
  <!-- Header -->
  <app-header
    [isLoading]="isLoading"
    [isRenameMode]="isRenameMode"
    [isReorderMode]="isReorderMode"
    [playbackProgress]="playbackProgress"
    (search)="onSearch($event)"
    (refresh)="refreshSounds()"
    (toggleRenameMode)="toggleRenameMode()"
    (toggleReorderMode)="toggleReorderMode()"
    (toggleSettings)="toggleSettingsModal()"
    (addSound)="openAddSoundModal()"
  ></app-header>

  <!-- Main Content / Settings -->
  <app-content
    *ngIf="!isSettingsModalOpen"
    [categories]="categories"
    [filteredSounds]="filteredSounds"
    [isLoading]="isLoading"
    [searchQuery]="searchQuery"
    [currentlyPlayingIndex]="currentlyPlayingIndex"
    [isRenameMode]="isRenameMode"
    [isReorderMode]="isReorderMode"
    [activeCategory]="activeCategory"
    (playSound)="playSound($event)"
    (openRenameModal)="openRenameModal($event)"
    (activeCategoryChange)="activeCategory = $event"
    (reorderSound)="onReorderSound($event)"
    (reorderCategory)="onReorderCategory($event)"
    (dragStateChange)="onDragStateChange($event)"
  ></app-content>

  <app-settings
    *ngIf="isSettingsModalOpen"
    [configWatchEnabled]="configWatchEnabled"
    [autoLaunchEnabled]="autoLaunchEnabled"
    [keepAwakeEnabled]="keepAwakeEnabled"
    [idleTimeoutEnabled]="idleTimeoutEnabled"
    [wakeMinutes]="wakeMinutes"
    [isRestarting]="isRestarting"
    (saveSettings)="onSaveSettings($event)"
    (restartSoundpad)="restartSoundpad()"
    (closeSettings)="toggleSettingsModal()"
  ></app-settings>

  <!-- Footer with Playback Controls -->
  <app-footer
    [isConnected]="isConnected"
    [currentlyPlayingIndex]="currentlyPlayingIndex"
    [isPaused]="isPaused"
    [playbackProgress]="playbackProgress"
    [playbackTimeRemaining]="playbackTimeRemaining"
    [volume]="volume"
    [playbackMode]="playbackMode"
    [autoLaunchEnabled]="autoLaunchEnabled"
    [isLaunching]="isLaunching"
    [launchErrorMessage]="launchErrorMessage"
    [launchRetryCountdown]="launchRetryCountdown"
    (stop)="stopSound()"
    (togglePause)="togglePause()"
    (volumeChange)="setVolume($event)"
    (playbackModeChange)="setPlaybackMode($event)"
    (manualLaunch)="manualLaunchSoundpad()"
  ></app-footer>

  <!-- Rename Modal -->
  <app-rename-modal
    [isOpen]="isRenameModalOpen"
    [sound]="soundToRename"
    (closed)="onRenameClosed()"
    (renamed)="onSoundRenamed($event)"
  ></app-rename-modal>

  <!-- Are You Still There? Dialog -->
  <app-wake-dialog
    [isOpen]="isWakeDialogOpen"
    [isUiDimmed]="isUiDimmed"
    [countdownSeconds]="wakeCountdownSeconds"
    (dismissed)="dismissWakeDialog()"
  ></app-wake-dialog>

  <!-- Add Sound Modal -->
  <app-add-sound-modal
    [isOpen]="isAddSoundModalOpen"
    [sounds]="sounds"
    [categoryIconsMap]="categoryIconsMap"
    (closed)="onAddSoundClosed()"
    (soundAdded)="onSoundAdded()"
  ></app-add-sound-modal>
</div>
