<div class="app-container">
  <!-- Header -->
  <app-header
    [isLoading]="isLoading"
    [isRenameMode]="isRenameMode"
    [playbackProgress]="playbackProgress"
    (search)="onSearch($event)"
    (refresh)="refreshSounds()"
    (toggleRenameMode)="toggleRenameMode()"
    (toggleSettings)="toggleSettingsModal()"
  ></app-header>

  <!-- Main Content -->
  <app-content
    [categories]="categories"
    [filteredSounds]="filteredSounds"
    [isLoading]="isLoading"
    [searchQuery]="searchQuery"
    [currentlyPlayingIndex]="currentlyPlayingIndex"
    [isRenameMode]="isRenameMode"
    [activeCategory]="activeCategory"
    (playSound)="playSound($event)"
    (openRenameModal)="openRenameModal($event)"
    (activeCategoryChange)="activeCategory = $event"
  ></app-content>

  <!-- Footer with Playback Controls -->
  <app-footer
    [isConnected]="isConnected"
    [currentlyPlayingIndex]="currentlyPlayingIndex"
    [isPaused]="isPaused"
    [playbackProgress]="playbackProgress"
    [playbackTimeRemaining]="playbackTimeRemaining"
    [volume]="volume"
    [playbackMode]="playbackMode"
    (stop)="stopSound()"
    (togglePause)="togglePause()"
    (volumeChange)="setVolume($event)"
    (playbackModeChange)="setPlaybackMode($event)"
  ></app-footer>

  <!-- Rename Modal -->
  <div class="modal-overlay" *ngIf="isRenameModalOpen" (click)="cancelRename()">
    <div class="modal-content rename-modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Rename Sound</h2>
        <button class="close-btn" (click)="cancelRename()">&times;</button>
      </div>
      <div class="modal-body">
        <p class="rename-current-name">Current name: <strong>{{ soundToRename?.title }}</strong></p>
        <div class="rename-input-group">
          <input
            #renameInput
            type="text"
            class="rename-input"
            [(ngModel)]="renameValue"
            placeholder="Enter new name"
            (keydown.enter)="confirmRename()"
            (keydown.escape)="cancelRename()"
          />
        </div>
        <div class="rename-actions">
          <button class="rename-cancel-btn" (click)="cancelRename()">Cancel</button>
          <button
            class="rename-confirm-btn"
            (click)="confirmRename()"
            [disabled]="!renameValue.trim() || isRenaming"
          >
            <svg *ngIf="isRenaming" class="spinning" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" style="width: 16px; height: 16px; margin-right: 6px;">
              <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
            </svg>
            {{ isRenaming ? 'Renaming...' : 'Confirm' }}
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div class="modal-overlay" *ngIf="isSettingsModalOpen" (click)="toggleSettingsModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Settings</h2>
        <button class="close-btn" (click)="toggleSettingsModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="settings-section">
          <h3>Soundpad Actions</h3>
          <p>If Soundpad is unresponsive or needs to be reloaded, you can restart it here.</p>
          <button
            class="restart-btn"
            (click)="restartSoundpad()"
            [disabled]="isRestarting"
          >
            <svg *ngIf="isRestarting" class="spinning" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" style="width: 18px; height: 18px; margin-right: 8px;">
              <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
            </svg>
            {{ isRestarting ? 'Restarting...' : 'Restart Soundpad' }}
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
