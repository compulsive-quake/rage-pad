<div class="app-container">
  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <div class="logo">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="logo-icon">
          <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/>
        </svg>
        <h1>Rage Pad</h1>
      </div>
      <div class="header-search">
        <app-search-bar (search)="onSearch($event)"></app-search-bar>
      </div>
      <div class="header-actions">
        <button class="refresh-btn-icon" (click)="refreshSounds()" [disabled]="isLoading" title="Refresh sounds">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" [class.spinning]="isLoading">
            <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
          </svg>
        </button>
        <button class="settings-btn-icon" (click)="toggleSettingsModal()" title="Settings">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/>
          </svg>
        </button>
        <app-connection-status [isConnected]="isConnected"></app-connection-status>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main-content" #mainContent>
    <div class="main-content-inner">

      <!-- Sound Grid -->
      <section class="sounds-section">
      <!-- Loading State -->
      <div class="loading-state" *ngIf="isLoading">
        <div class="spinner"></div>
        <p>Loading sounds...</p>
      </div>

      <!-- Empty State -->
      <div class="empty-state" *ngIf="!isLoading && filteredSounds.length === 0 && !searchQuery">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/>
        </svg>
        <h2>No Sounds Found</h2>
        <p>Make sure Soundpad is running and has sounds loaded.</p>
        <button class="retry-btn" (click)="refreshSounds()">Try Again</button>
      </div>

      <!-- No Results State -->
      <div class="empty-state" *ngIf="!isLoading && filteredSounds.length === 0 && searchQuery">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <circle cx="11" cy="11" r="8" fill="none" stroke="currentColor" stroke-width="2"/>
          <path d="M21 21l-4.35-4.35" fill="none" stroke="currentColor" stroke-width="2"/>
        </svg>
        <h2>No Results</h2>
        <p>No sounds match "{{ searchQuery }}"</p>
      </div>

      <!-- Sound Grid - Centered -->
      <div class="sounds-grid-wrapper" *ngIf="!isLoading && filteredSounds.length > 0">
        <div class="categories-container" #categoriesContainer>
          <div class="category-section"
               *ngFor="let category of categories; trackBy: trackByCategory"
               [attr.data-category]="category.name"
               #categoryElement>
            <!-- Category Divider -->
            <div class="category-divider">
              <div class="category-icon" [class.has-image]="category.image">
                <img *ngIf="category.image" [src]="category.image" alt="{{ category.name }}" />
                <svg *ngIf="!category.image" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                  <path [attr.d]="getCategoryIcon(category.name)"/>
                </svg>
              </div>
              <h2 class="category-title">{{ category.name }}</h2>
              <span class="category-count">{{ category.sounds.length }} sounds</span>
              <div class="category-line"></div>
            </div>
            
            <!-- Sounds Grid for this category -->
            <div class="sounds-grid">
              <app-sound-card
                *ngFor="let sound of category.sounds; trackBy: trackByIndex"
                [sound]="sound"
                [isPlaying]="currentlyPlayingIndex === sound.index"
                (play)="playSound($event)"
              ></app-sound-card>
            </div>
          </div>
        </div>
      </div>
    </section>
    </div>
  </main>

  <!-- Footer with Playback Controls -->
  <footer class="footer">
    <!-- Progress Bar as top border -->
    <div class="progress-bar-border">
      <div class="progress-bar" [style.width.%]="playbackProgress"></div>
    </div>
    
    <div class="footer-controls">
      <div class="time-remaining-container">
        <span class="time-remaining" *ngIf="currentlyPlayingIndex !== null">{{ formatTime(playbackTimeRemaining) }}</span>
      </div>

      <div class="control-buttons">
        <button 
          class="control-btn stop-btn" 
          (click)="stopSound()"
          [disabled]="currentlyPlayingIndex === null"
          title="Stop"
        >
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <rect x="6" y="6" width="12" height="12"/>
          </svg>
        </button>
        
        <button 
          class="control-btn pause-btn" 
          (click)="togglePause()"
          [disabled]="currentlyPlayingIndex === null"
          title="Pause/Resume"
        >
          <svg *ngIf="!isPaused" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>
          </svg>
          <svg *ngIf="isPaused" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M8 5v14l11-7z"/>
          </svg>
        </button>
      </div>

      <div class="volume-control">
        <button
          class="mic-only-btn"
          [class.active]="micOnly"
          (click)="toggleMicOnly()"
          title="Play on microphone only"
        >
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm-1-9c0-.55.45-1 1-1s1 .45 1 1v6c0 .55-.45 1-1 1s-1-.45-1-1V5zm6 6c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
          </svg>
        </button>
        <button
          class="speakers-only-btn"
          [class.active]="speakersOnly"
          (click)="toggleSpeakersOnly()"
          title="Play on speakers only (headphones)"
        >
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 1c-4.97 0-9 4.03-9 9v7c0 1.66 1.34 3 3 3h3v-8H5v-2c0-3.87 3.13-7 7-7s7 3.13 7 7v2h-4v8h3c1.66 0 3-1.34 3-3v-7c0-4.97-4.03-9-9-9z"/>
          </svg>
        </button>
        <svg class="volume-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path *ngIf="volume > 50" d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
          <path *ngIf="volume > 0 && volume <= 50" d="M18.5 12c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM5 9v6h4l5 5V4L9 9H5z"/>
          <path *ngIf="volume === 0" d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"/>
        </svg>
        <input
          type="range"
          class="volume-slider"
          min="0"
          max="100"
          [(ngModel)]="volume"
          (change)="setVolume(volume)"
        />
        <span class="volume-value">{{ volume }}%</span>
      </div>
    </div>
  </footer>

  <!-- Settings Modal -->
  <div class="modal-overlay" *ngIf="isSettingsModalOpen" (click)="toggleSettingsModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Settings</h2>
        <button class="close-btn" (click)="toggleSettingsModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="settings-section">
          <h3>Soundpad Actions</h3>
          <p>If Soundpad is unresponsive or needs to be reloaded, you can restart it here.</p>
          <button 
            class="restart-btn" 
            (click)="restartSoundpad()" 
            [disabled]="isRestarting"
          >
            <svg *ngIf="isRestarting" class="spinning" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" style="width: 18px; height: 18px; margin-right: 8px;">
              <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
            </svg>
            {{ isRestarting ? 'Restarting...' : 'Restart Soundpad' }}
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
