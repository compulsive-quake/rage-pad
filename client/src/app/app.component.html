<div class="app-container" [class.wake-blur]="isWakeDialogOpen" [class.wake-dimmed]="isUiDimmed">
  <!-- Header -->
  <app-header
    [isLoading]="isLoading"
    [isRenameMode]="isRenameMode"
    [isReorderMode]="isReorderMode"
    [playbackProgress]="playbackProgress"
    (search)="onSearch($event)"
    (refresh)="refreshSounds()"
    (toggleRenameMode)="toggleRenameMode()"
    (toggleReorderMode)="toggleReorderMode()"
    (toggleSettings)="toggleSettingsModal()"
    (addSound)="openAddSoundModal()"
  ></app-header>

  <!-- Main Content / Settings -->
  <app-content
    *ngIf="!isSettingsModalOpen"
    [categories]="categories"
    [filteredSounds]="filteredSounds"
    [isLoading]="isLoading"
    [searchQuery]="searchQuery"
    [currentlyPlayingIndex]="currentlyPlayingIndex"
    [isRenameMode]="isRenameMode"
    [isReorderMode]="isReorderMode"
    [activeCategory]="activeCategory"
    (playSound)="playSound($event)"
    (openRenameModal)="openRenameModal($event)"
    (activeCategoryChange)="activeCategory = $event"
    (reorderSound)="onReorderSound($event)"
    (reorderCategory)="onReorderCategory($event)"
    (dragStateChange)="onDragStateChange($event)"
    (soundContextMenu)="onSoundContextMenu($event)"
  ></app-content>

  <app-settings
    *ngIf="isSettingsModalOpen"
    [configWatchEnabled]="configWatchEnabled"
    [autoLaunchEnabled]="autoLaunchEnabled"
    [keepAwakeEnabled]="keepAwakeEnabled"
    [idleTimeoutEnabled]="idleTimeoutEnabled"
    [wakeMinutes]="wakeMinutes"
    [isRestarting]="isRestarting"
    [serverPort]="serverPort"
    [isPortChanging]="isPortChanging"
    [portChangeError]="portChangeError"
    [autoUpdateCheckEnabled]="autoUpdateCheckEnabled"
    [updateCheckIntervalMinutes]="updateCheckIntervalMinutes"
    [isCheckingForUpdate]="isCheckingForUpdate"
    [latestVersion]="latestVersion"
    [updateAvailable]="updateAvailable"
    (saveSettings)="onSaveSettings($event)"
    (restartSoundpad)="restartSoundpad()"
    (closeSettings)="toggleSettingsModal()"
    (checkForUpdates)="manualUpdateCheck()"
  ></app-settings>

  <!-- Footer with Playback Controls -->
  <app-footer
    [isConnected]="isConnected"
    [currentlyPlayingIndex]="currentlyPlayingIndex"
    [isPaused]="isPaused"
    [playbackProgress]="playbackProgress"
    [playbackTimeRemaining]="playbackTimeRemaining"
    [volume]="volume"
    [playbackMode]="playbackMode"
    [autoLaunchEnabled]="autoLaunchEnabled"
    [isLaunching]="isLaunching"
    [launchErrorMessage]="launchErrorMessage"
    [launchRetryCountdown]="launchRetryCountdown"
    [updateAvailable]="updateAvailable && !updateDismissed"
    [latestVersion]="latestVersion"
    [downloadUrl]="downloadUrl"
    (stop)="stopSound()"
    (togglePause)="togglePause()"
    (volumeChange)="setVolume($event)"
    (playbackModeChange)="setPlaybackMode($event)"
    (manualLaunch)="manualLaunchSoundpad()"
    (dismissUpdate)="dismissUpdate()"
  ></app-footer>

  <!-- Rename Modal -->
  <app-rename-modal
    [isOpen]="isRenameModalOpen"
    [sound]="soundToRename"
    (closed)="onRenameClosed()"
    (renamed)="onSoundRenamed($event)"
  ></app-rename-modal>

  <!-- Are You Still There? Dialog -->
  <app-wake-dialog
    [isOpen]="isWakeDialogOpen"
    [isUiDimmed]="isUiDimmed"
    [countdownSeconds]="wakeCountdownSeconds"
    (dismissed)="dismissWakeDialog()"
  ></app-wake-dialog>

  <!-- Add Sound Modal -->
  <app-add-sound-modal
    [isOpen]="isAddSoundModalOpen"
    [sounds]="sounds"
    [categoryIconsMap]="categoryIconsMap"
    (closed)="onAddSoundClosed()"
    (soundAdded)="onSoundAdded()"
  ></app-add-sound-modal>

  <!-- Context Menu (desktop Tauri build only) -->
  <app-context-menu
    [visible]="contextMenuVisible"
    [x]="contextMenuX"
    [y]="contextMenuY"
    (closed)="onContextMenuClosed()"
    (editSound)="onContextMenuEdit()"
    (deleteSound)="onContextMenuDelete()"
  ></app-context-menu>

  <!-- Edit Sound Modal -->
  <app-edit-sound-modal
    [isOpen]="isEditSoundModalOpen"
    [sound]="soundToEdit"
    (closed)="onEditSoundClosed()"
    (saved)="onEditSoundSaved()"
  ></app-edit-sound-modal>

  <!-- Delete Confirmation Dialog -->
  <div class="modal-backdrop" *ngIf="isDeleteConfirmOpen" (click)="cancelDelete()">
    <div class="delete-confirm-dialog" (click)="$event.stopPropagation()">
      <h3>Delete Sound</h3>
      <p>Are you sure you want to delete <strong>{{ soundToDelete?.title }}</strong>?</p>
      <p class="delete-warning">This will remove the sound from Soundpad and permanently delete the audio file.</p>
      <div class="delete-confirm-actions">
        <button class="btn-cancel" (click)="cancelDelete()" [disabled]="isDeleting">Cancel</button>
        <button class="btn-delete" (click)="confirmDelete()" [disabled]="isDeleting">
          <span *ngIf="!isDeleting">Delete</span>
          <span *ngIf="isDeleting">Deleting...</span>
        </button>
      </div>
    </div>
  </div>
</div>
