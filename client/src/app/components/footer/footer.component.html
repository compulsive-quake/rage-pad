<footer class="footer">
  <!-- Progress Bar as top border -->
  <div class="progress-bar-border">
    <div class="progress-bar" [style.width.%]="playbackProgress"></div>
  </div>

  <div class="footer-controls">
    <div class="time-remaining-container">
      <app-connection-status [isConnected]="isConnected"></app-connection-status>
      <span class="time-remaining" *ngIf="currentlyPlayingId !== null">{{ formatTime(playbackTimeRemaining) }}</span>
    </div>

    <div class="control-buttons">
      <button
        class="control-btn stop-btn"
        (click)="onStop()"
        [disabled]="currentlyPlayingId === null"
        title="Stop"
      >
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <rect x="6" y="6" width="12" height="12"/>
        </svg>
      </button>

      <button
        class="control-btn pause-btn"
        (click)="onTogglePause()"
        [disabled]="currentlyPlayingId === null"
        title="Pause/Resume"
      >
        <svg *ngIf="!isPaused" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>
        </svg>
        <svg *ngIf="isPaused" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M8 5v14l11-7z"/>
        </svg>
      </button>
    </div>

    <div class="volume-control">
      <div class="playback-mode-toggle" role="group" aria-label="Playback mode">
        <button
          class="mode-btn"
          [class.active]="playbackMode === 'speakers'"
          (click)="onSetPlaybackMode('speakers')"
          title="Play on speakers only (headphones)"
        >
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 1c-4.97 0-9 4.03-9 9v7c0 1.66 1.34 3 3 3h3v-8H5v-2c0-3.87 3.13-7 7-7s7 3.13 7 7v2h-4v8h3c1.66 0 3-1.34 3-3v-7c0-4.97-4.03-9-9-9z"/>
          </svg>
        </button>
        <button
          class="mode-btn"
          [class.active]="playbackMode === 'both'"
          (click)="onSetPlaybackMode('both')"
          title="Play on both microphone and speakers"
        >
          Both
        </button>
        <button
          class="mode-btn"
          [class.active]="playbackMode === 'mic'"
          (click)="onSetPlaybackMode('mic')"
          title="Play on microphone only"
        >
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm-1-9c0-.55.45-1 1-1s1 .45 1 1v6c0 .55-.45 1-1 1s-1-.45-1-1V5zm6 6c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
          </svg>
        </button>
      </div>
      <svg class="volume-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
        <path *ngIf="volume > 50" d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
        <path *ngIf="volume > 0 && volume <= 50" d="M18.5 12c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM5 9v6h4l5 5V4L9 9H5z"/>
        <path *ngIf="volume === 0" d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"/>
      </svg>
      <input
        type="range"
        class="volume-slider"
        min="0"
        max="100"
        [(ngModel)]="volume"
        (input)="onVolumeChange(volume)"
      />
      <span class="volume-value">{{ volume }}%</span>
    </div>
  </div>

  <!-- Update available banner -->
  <div class="update-banner" *ngIf="updateAvailable">
    <div class="update-banner-content">
      <svg class="update-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
      </svg>

      <!-- Default state: show version + download button -->
      <ng-container *ngIf="!isDownloading && !downloadDone && !downloadError">
        <span class="update-text">A new version <strong>(v{{ latestVersion }})</strong> is available</span>
        <button class="update-download-btn" (click)="onDownloadUpdate()">Download</button>
      </ng-container>

      <!-- Downloading: show progress bar -->
      <ng-container *ngIf="isDownloading">
        <span class="update-text">Downloading v{{ latestVersion }}â€¦</span>
        <div class="update-progress-bar">
          <div class="update-progress-fill" [style.width.%]="downloadPercent"></div>
        </div>
        <span class="update-percent">{{ downloadPercent }}%</span>
      </ng-container>

      <!-- Done: show install button -->
      <ng-container *ngIf="downloadDone">
        <span class="update-text">v{{ latestVersion }} ready to install</span>
        <button class="update-download-btn" (click)="onLaunchInstaller()">Install</button>
      </ng-container>

      <!-- Error -->
      <ng-container *ngIf="downloadError">
        <span class="update-error-text">{{ downloadError }}</span>
        <button class="update-download-btn" (click)="downloadError = ''; onDownloadUpdate()">Retry</button>
      </ng-container>
    </div>
    <button class="update-dismiss-btn" (click)="onDismissUpdate()" title="Dismiss" *ngIf="!isDownloading && !downloadDone">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
        <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
      </svg>
    </button>
  </div>
</footer>
