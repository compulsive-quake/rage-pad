<div class="modal-overlay" *ngIf="isOpen" (click)="close()">
  <div class="modal-content edit-details-modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Edit Details</h2>
      <button class="close-btn" (click)="close()">&times;</button>
    </div>
    <div class="modal-body edit-details-modal-body">
      <div class="form-fields">
        <!-- Title (full width) -->
        <div class="form-field-col form-field-title">
          <label class="category-label">Title <span class="required-star">*</span></label>
          <input
            type="text"
            class="sound-name-input"
            [(ngModel)]="editTag"
            placeholder="Enter title (required)"
          />
        </div>

        <!-- Icon -->
        <div class="icon-upload-row">
          <label class="category-label">Icon</label>
          <div class="icon-upload-controls">
            <img
              *ngIf="iconPreviewUrl"
              [src]="iconPreviewUrl"
              class="icon-preview"
              alt="Icon preview"
            />
            <div
              *ngIf="!iconPreviewUrl"
              class="icon-preview icon-placeholder"
            >
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
                <path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/>
              </svg>
            </div>
            <button
              type="button"
              class="icon-upload-btn"
              (click)="iconFileInput.click()"
            >Choose Image</button>
            <button
              type="button"
              class="icon-remove-btn"
              *ngIf="iconPreviewUrl"
              (click)="removeIcon()"
            >Remove</button>
            <input
              #iconFileInput
              type="file"
              accept="image/*"
              style="display: none"
              (change)="onIconSelected($event)"
            />
          </div>
        </div>

        <!-- Row 2: Artist | Category -->
        <div class="form-fields-row">
          <!-- Artist -->
          <div class="form-field-col">
            <label class="category-label">Artist</label>
            <div class="field-input-row artist-autocomplete-wrapper">
              <input
                type="text"
                class="sound-name-input"
                [(ngModel)]="editArtist"
                placeholder="Enter artist"
                autocomplete="off"
                (input)="onArtistInput()"
                (focus)="onArtistFocus()"
                (blur)="onArtistBlur()"
              />
              <button
                class="field-clear-btn"
                *ngIf="editArtist"
                (click)="editArtist = ''; showArtistSuggestions = false"
                title="Clear artist"
                type="button"
              >&times;</button>
              <!-- Autocomplete dropdown -->
              <ul class="artist-suggestions" *ngIf="showArtistSuggestions">
                <li
                  *ngFor="let artist of filteredArtistSuggestions"
                  class="artist-suggestion-item"
                  (mousedown)="selectArtistSuggestion(artist)"
                >{{ artist }}</li>
              </ul>
            </div>
          </div>
          <!-- Category -->
          <div class="form-field-col">
            <label class="category-label">Category</label>
            <app-category-select
              [categories]="categories"
              [categoryIconsMap]="categoryIconsMap"
              [selected]="editCategory"
              (selectionChange)="onCategoryChange($event)"
            ></app-category-select>
          </div>
        </div>

        <!-- Hide Title Toggle -->
        <div class="hide-title-row">
          <label class="category-label hide-title-label">Hide title</label>
          <label class="toggle-switch">
            <input type="checkbox" [(ngModel)]="editHideTitle" />
            <span class="toggle-slider"></span>
          </label>
        </div>

        <!-- Error message -->
        <p *ngIf="errorMessage" class="edit-details-error">{{ errorMessage }}</p>
      </div>
    </div>

    <!-- Actions footer -->
    <div class="edit-details-actions">
      <button class="cancel-btn" (click)="close()" [disabled]="isSaving">Cancel</button>
      <button
        class="save-btn"
        (click)="save()"
        [disabled]="!editTag.trim() || isSaving"
      >
        <svg *ngIf="isSaving" class="spinning" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" style="width: 16px; height: 16px; margin-right: 6px;">
          <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
        </svg>
        {{ isSaving ? 'Saving...' : 'Save' }}
      </button>
    </div>
  </div>
</div>
